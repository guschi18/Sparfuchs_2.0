## Cursor Rules 

You are an expert Senior Software Engineer.

**<PRIORITY NUMBER 1>** Change as little code as necessary! Maintain existing patterns and style.

**BEHAVIOR & REASONING:**
- Utilize your full context window to understand dependencies and side effects.
- Think deeply before generating code. Verify logic, types, and edge cases internally.
- If the request is ambiguous, ask clarifying questions immediately.



## 0. Docs-Preflight (Verpflichtend vor jeder Implementierung)

**Offizielle Dokumentation hat IMMER Vorrang vor Modellwissen!**

Vor jedem Coding-Task:
1. **Betroffene Dependencies identifizieren**: Welche Technologien werden genutzt?
2. **`docs/dependency-docs.md` Ã¶ffnen**: Zentrale Ãœbersicht mit Links zu offiziellen Docs
3. **Offizielle Docs prÃ¼fen**: Verlinkte Dokumentationen konsultieren
4. **Bei VersionssprÃ¼ngen**: Migration-Guide lesen, relevante Notizen in `dependency-docs.md` ergÃ¤nzen

âš ï¸ **KRITISCH - Versions-Regel**:
- Nutze Dokumentation zur **AKTUELL installierten Version** (siehe `package.json`)
- **NIEMALS Dependencies upgraden** ohne explizite Anweisung des Entwicklers

## Standard Workflow
1. First think through the problem, read the codebase for relevant files, and write a plan to projectplan.md.
2. The plan should have a list of todo items that you can check off as you complete them
3. Before you begin working, check in with me and I will verify the plan.
4. Then, begin working on the todo items, marking them as complete as you go.
5. Please every step of the way just give me a high level explanation of what changes you made
6. Make every task and code change you do as simple as possible. We want to avoid making any massive or complex changes. Every change should impact as little code as possible. Everything is about simplicity.
7. Finally, add a review section to the projectplan.md file with a summary of the changes you made and any other relevant information.

## <prompt-optimization> XML-Tag Usage
- **<context>**: Use XML-like tags in prompts for better structure recognition
- **<examples>**: `<new-feature>`, `<bug-fix>`, `<analysis>`, `<research>`, `<ui-update>`, `<data-processing>`
- **<benefit>**: Claude understands structured prompts better and works more efficiently
- **<usage>**: Categorize requests with tags for more precise responses

## Development Commands
All commands run from project root directory:
- `npm run dev` - Development server (default port 3000)
- `npm run build` - Production build
- `npm run lint` - Code quality check
- `npm run test` - Run Jest tests
- `npm run generate:docs` - Generate documentation
- `npm run analyze:queries` - Analyze user search queries

## Architecture Overview

### Technology Stack
- **Framework**: Next.js 14.2.18 (App Router)
- **Styling**: Tailwind CSS v3.3.6 + HeroUI v2.6.14
- **AI**: OpenRouter API (google/gemini-2.5-flash-lite)
- **Data**: CSV-Parse v6.1.0 (JSONL Offers)
- **Testing**: Jest v29.7.0

### Project Structure
```
/
â”œâ”€â”€ app/              # Next.js App Router pages & components
â”œâ”€â”€ lib/              # Services & Utilities (AI, Data, Hooks)
â”œâ”€â”€ types/            # TypeScript Type Definitions
â”œâ”€â”€ scripts/          # Build, documentation & analysis scripts
â”œâ”€â”€ docs/             # Comprehensive documentation (100% coverage)
â”œâ”€â”€ Angebote/         # Offers data directory (JSONL format)
â””â”€â”€ Prompts/          # AI prompts & optimization guides
```

## ğŸ“‹ Documentation Reference Map

### ğŸ  App Components - Details in `docs/app/components/`
- **Chat**: `Chat/` (Input, Message, ProductCard)
- **Layout**: `Layout/` (Header, Footer)
- **UI**: `UI/` (ShoppingList, Wishlist/Merkzettel, Toasts, MarketToggles)
- **Error**: `Error/` (Boundaries)

### ğŸ¤– AI Integration - Details in `docs/lib/ai/`
- **OpenRouter Client**: `openrouter_documentation.md` (Streaming, SSE)
- **Embeddings**: `openrouter_documentation.md` (Vector generation)

### ğŸ“Š Data Management - Details in `docs/lib/data/`
- **Offers System**: `offers_documentation.md` (Loading, Transformation)
- **Semantic Search**: `docs/lib/search/semantic_documentation.md` (Vector Index, Cosine Similarity)

### ğŸ£ Custom Hooks - Details in `docs/lib/hooks/`
- **Shopping List**: `useShoppingList_documentation.md`
- **Wishlist (Merkzettel)**: `useWishlist_documentation.md`
- **Chat History**: `useChatHistory_documentation.md`
- **Toasts**: `useToast_documentation.md`

### ğŸ› ï¸ Utilities - Details in `docs/lib/utils/`
- **Env**: `env_documentation.md` (Required Variables)
- **Constants**: `constants_documentation.md` (Config)
- **LocalStorage**: `localStorage_documentation.md`

### ğŸ“š Dependency Documentation - Details in `docs/dependency-docs.md`
- **Central Reference**: All 8 core dependencies with versions & docs links.
- **Mandatory Preflight**: Check this before using any external lib.

### ğŸ”§ Scripts & Systems - Details in `docs/scripts/`
- **Query-Logging**: `Queries/README.md`
- **Synonym-Management**: `Synonyms/README.md`

## Quick Reference

### Important File Paths
- **Chat API**: `app/api/chat/route.ts`
- **Offers Loader**: `lib/data/offers.ts`
- **Semantic Search**: `lib/search/semantic.ts`
- **OpenRouter Client**: `lib/ai/openrouter.ts`
- **Global Styles**: `app/globals.css`

### Code Style Guidelines
1. **TypeScript Strict Mode**: Always maintain strict type checking
2. **'use client' Directive**: Required for components using hooks
3. **Animations**: Use Framer Motion with consistent spring configs
4. **Naming**: PascalCase for components, camelCase for functions
5. **Error Messages**: User-friendly German language messages
